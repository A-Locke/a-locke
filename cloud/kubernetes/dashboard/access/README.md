# Kubernetes Dashboard Login Guide for OKE

## Why This Setup is Needed

Oracle Kubernetes Engine (OKE) is a **managed Kubernetes service**, meaning:
- The control plane (API Server) is managed by Oracle; customers **cannot edit API server flags**, such as `--service-account-extend-token-expiration`.
- As a result, tokens generated for service accounts or kubeconfig authentication **expire within 1 hour by default**.

To avoid manual token regeneration for dashboard login, the recommended approach is to enable both **token** and **kubeconfig** login modes.

---

## Enabling Authentication Modes in Dashboard Deployment

Edit your `kubernetes-dashboard` deployment to include:

```yaml
args:
  - --auto-generate-certificates
  - --namespace=kubernetes-dashboard
  - --authentication-mode=kubeconfig,token
```

Deployment can be edited by running:
```powershell
 kubectl -n kubernetes-dashboard edit deployment kubernetes-dashboard -o yaml
```

This allows users to log in with either:
- A short-lived token generated by `kubectl create token`
- A kubeconfig file (with token managed manually or automated)

---

## Optional for Development Only: Skip Login

For quick testing in isolated environments **(Not Recommended for Production)**:

```yaml
args:
  - --enable-skip-login
```

This disables authentication entirely; anyone with network access to the dashboard can use it.

---

## Preparing the Kubeconfig File for Dashboard Login

Here is the recommended structure for your kubeconfig file **without embedded tokens**, so tokens can be refreshed automatically:

```yaml
apiVersion: v1
kind: Config
clusters:
- cluster:
    server: <REPLACE_WITH_YOUR_CLUSTER_API_ADDRESS>
    certificate-authority-data: <REPLACE_WITH_YOUR_CA_DATA>
  name: cluster
contexts:
- context:
    cluster: cluster
    user: admin-user
  name: admin-context
current-context: admin-context
users:
- name: admin-user
  user:
    token: <INSERT_TOKEN_HERE>
```

Cluster's API address can be obtained by running:

```powershell
  kubectl config view --minify -o jsonpath='{.clusters[0].cluster.server}'
```

### Replace:
- `<REPLACE_WITH_YOUR_CA_DATA>` with your existing certificate authority data.
- `<INSERT_TOKEN_HERE>` with a valid token, refreshed regularly.

Tokens can be generated using:

```powershell
kubectl -n kubernetes-dashboard create token admin-user
```

---

## Automating Token Refresh with a PowerShell Script

Create a script named `refresh-dashboard-token.ps1`:

```powershell
$token = kubectl -n kubernetes-dashboard create token admin-user
(Get-Content "C:\path\to\your\kubeconfig") -replace '(?<=token: ).*', $token | Set-Content "C:\path\to\your\kubeconfig"
```

### Notes:
- Replace `C:\path\to\your\kubeconfig` with the actual path to your kubeconfig file.
- Run this script whenever you need a fresh token.

---

## Scheduling Automatic Token Refresh with Windows Task Scheduler

1. Open **Task Scheduler**.
2. Create a new basic task:
   - Name: `Refresh Dashboard Token`
3. Set Trigger:
   - Example: Every 30 minutes (adjust based on token expiration)
4. Set Action:
   - Program: `powershell.exe`
   - Arguments:

```powershell
-ExecutionPolicy Bypass -File "C:\path\to\refresh-dashboard-token.ps1"
```

5. Confirm and finish the task setup.

This ensures your kubeconfig token stays up to date automatically.

---

## Creating a Manual Shortcut to Refresh Token

To create a desktop shortcut for manual token refresh:

1. Right-click desktop → **New → Shortcut**
2. Enter:

```powershell
schtasks /run /tn "Refresh Dashboard Token"
```

3. Name the shortcut (e.g., `Manual Dashboard Token Refresh`)
4. Optionally, change the icon for visibility.

Double-clicking this shortcut runs the token refresh immediately.

---

## Summary

✅ Use `--authentication-mode=kubeconfig,token` for flexibility.  
✅ Automate kubeconfig token updates with PowerShell + Task Scheduler.  
✅ Avoid `--enable-skip-login` except in dev environments.  
✅ Managed OKE restrictions prevent extending token expiration beyond default limits.  

This setup minimizes manual effort while maintaining secure, regular dashboard access.

